{% comment %}
  Renders the collection filters sidebar or off-canvas panel.
{% endcomment %}

<div class="filters-wrapper" id="filters-wrapper">
  <div class="filters-header">
    <h2 class="h3">Filter</h2>
    <button class="filters-close-btn" onclick="toggleDesktopFilters()" aria-label="Close Filters">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <form class="filters-form" id="filters-form">
    <!-- Availability Filter -->
    {% if section.settings.enable_availability %}
      <div class="filter-group">
        <h3>Availability</h3>
        <label class="filter-label">
          <input type="checkbox" name="filter.v.availability" value="1" {% if current_tags contains 'filter.v.availability:1' %}checked{% endif %}>
          <span>In Stock</span>
        </label>
      </div>
    {% endif %}

    <!-- Price Filter -->
    {% if section.settings.enable_price %}
      <div class="filter-group">
        <h3>Price</h3>
        <div class="price-filter">
          <div class="price-slider">
            <div class="progress"></div>
          </div>
          <div class="range-input">
            <input type="range" class="range-min" min="0" max="{{ collection.products.max_price | money_without_currency | replace: ',', '' }}" value="0" step="10">
            <input type="range" class="range-max" min="0" max="{{ collection.products.max_price | money_without_currency | replace: ',', '' }}" value="{{ collection.products.max_price | money_without_currency | replace: ',', '' }}" step="10">
          </div>
          <div class="price-input">
            <input type="number" class="input-min" value="0" min="0" max="{{ collection.products.max_price | money_without_currency | replace: ',', '' }}">
            <span>-</span>
            <input type="number" class="input-max" value="{{ collection.products.max_price | money_without_currency | replace: ',', '' }}" min="0" max="{{ collection.products.max_price | money_without_currency | replace: ',', '' }}">
          </div>
        </div>
      </div>
    {% endif %}

    <!-- Brand (Vendor) Filter -->
    {% if section.settings.enable_brand %}
      {% assign brand_list = section.settings.specific_brands | split: "," %}
      {% for product in collection.products %}
        {% unless brand_list contains product.vendor %}
          {% assign brand_list = brand_list | append: product.vendor | append: "," %}
        {% endunless %}
      {% endfor %}
      {% assign brands = brand_list | uniq | sort %}
      <div class="filter-group">
        <h3>Brand</h3>
        {% for brand in brands %}
          {% assign brand_handle = brand | handle | prepend: 'filter.v.vendor:' %}
          <label class="filter-label">
            <input type="checkbox" name="filter.v.vendor" value="{{ brand | handle }}" {% if current_tags contains brand_handle %}checked{% endif %}>
            <span>{{ brand }}</span>
          </label>
        {% endfor %}
      </div>
    {% endif %}

    <!-- Collection (Product Type) Filter -->
    {% if section.settings.enable_collection %}
      {% assign type_list = section.settings.specific_collections | split: "," %}
      {% for product in collection.products %}
        {% unless type_list contains product.type %}
          {% assign type_list = type_list | append: product.type | append: "," %}
        {% endunless %}
      {% endfor %}
      {% assign types = type_list | uniq | sort %}
      <div class="filter-group">
        <h3>Product Type</h3>
        {% for type in types %}
          {% assign type_handle = type | handle | prepend: 'filter.p.product_type:' %}
          <label class="filter-label">
            <input type="checkbox" name="filter.p.product_type" value="{{ type | handle }}" {% if current_tags contains type_handle %}checked{% endif %}>
            <span>{{ type }}</span>
          </label>
        {% endfor %}
      </div>
    {% endif %}
    
    <!-- Color Filter -->
    {% if section.settings.enable_color %}
      {% assign color_list = section.settings.specific_colors | split: "," %}
      {% for product in collection.products %}
        {% for tag in product.tags %}
          {% assign tag_prefix = tag | slice: 0, 6 %}
          {% if tag_prefix == 'color:' %}
            {% assign color_name = tag | remove: 'color:' %}
            {% unless color_list contains color_name %}
              {% assign color_list = color_list | append: color_name | append: "," %}
            {% endunless %}
          {% endif %}
        {% endfor %}
      {% endfor %}
      {% assign colors = color_list | uniq | sort %}
      <div class="filter-group">
        <h3>Color</h3>
        {% for color in colors %}
          {% assign color_handle = color | handle | prepend: 'filter.v.tag:' | prepend: 'color:' %}
          <label class="filter-label color-filter-label">
            <input type="checkbox" name="filter.v.tag" value="color:{{ color | handle }}" {% if current_tags contains color_handle %}checked{% endif %}>
            <span class="color-swatch" style="background-color: {{ color | downcase }};"></span>
            <span class="color-name">{{ color }}</span>
          </label>
        {% endfor %}
      </div>
    {% endif %}

    <!-- Custom Filters -->
    {% for i in (1..3) %}
      {% assign custom_filter_enable = 'enable_custom_filter_' | append: i %}
      {% assign custom_filter_title = 'custom_filter_' | append: i | append: '_title' %}
      {% assign custom_filter_tags = 'custom_filter_' | append: i | append: '_tags' %}
      
      {% if section.settings[custom_filter_enable] and section.settings[custom_filter_tags] != blank %}
        <div class="filter-group">
          <h3>{{ section.settings[custom_filter_title] }}</h3>
          {% assign tags = section.settings[custom_filter_tags] | split: "," %}
          {% for tag in tags %}
            {% assign tag_handle = tag | handle | prepend: 'filter.v.tag:' %}
            <label class="filter-label">
              <input type="checkbox" name="filter.v.tag" value="{{ tag | handle }}" {% if current_tags contains tag_handle %}checked{% endif %}>
              <span>{{ tag | strip }}</span>
            </label>
          {% endfor %}
        </div>
      {% endif %}
    {% endfor %}
  </form>
</div>